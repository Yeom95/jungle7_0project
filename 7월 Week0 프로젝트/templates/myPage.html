<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weekly Expenditure</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.3/css/bulma.min.css">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
  <style>
    .box {
      position: relative;
      height: 100px;
      margin-bottom: 1rem;
      width: 100px;
      text-align: center;
      padding: 1rem;
    }
    .box .day {
      position: absolute;
      top: 0;
      left: 0;
      margin: 0.5rem;
    }
    .box .date {
      position: absolute;
      top: 0;
      right: 0;
      margin: 0.5rem;
    }
    .box .data {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
    }
    .button.is-light:hover {
      background-color: #b5b5b5;
    }
    .section-title {
      margin-top: 2rem;
      margin-bottom: 1rem;
    }

    .is-centered {
      justify-content: center;
    }
  </style>

  <script>
    function moveDailySpending(date)
    {
      $.ajax({
                type: "POST",
                url: "/dailySpending",
                data: {
                    costDate: date,
                },
                success: function(response) {
                    if (response['result'] == 'success') {
                        // 성공 메시지를 표시
                        alert(response['msg']);
                        // 페이지를 이동하여 렌더링
                        window.location.href = `/dailySpendingPage?costDate=${date}`;
                    } else {
                        alert(response['msg']);
                    }
                },
                error: function(xhr, status, error) {
                    console.log("Error: " + error);
                    alert("An error occurred: " + xhr.responseText);
                }
            });
          
          
    }
  </script>
</head>
<body>
  <section class="section">
    <div class="container">
      <div class="field">
        <div class="control">
          <button class="button is-light">돌아가기</button>
        </div>
      </div>

      <h2 class="title is-4 section-title">이번 주 나의 지출은?</h2>
      <div class="columns is-centered">

        {% set days = ['일', '월', '화', '수', '목', '금', '토'] %}

{% for i in [7, 1, 2, 3, 4, 5, 6] %}
  {% set day_data = weekInfo | selectattr("day_of_week", "equalto", i) | list %}
  {% set date_value = day_data[0]['date_costs'][0]['date'] if day_data else '' %}
  <div onClick="moveDailySpending('{{ date_value }}')" class="box">
    <span class="day">{{ days[i % 7] }}</span>
    {% if day_data %}
    {% set total_cost = day_data[0]['date_costs'] | map(attribute='cost') | sum %}
      <div class="data">{{ total_cost }}</div>
    {% else %}
      <span class="date"></span>
      <div class="data"></div>
    {% endif %}
  </div>
{% endfor %}


        <!--{#<div class="column is-narrow">
          <div class="box">
            <span class="day">일</span>
            <span class="date">{{ weekInfo[6]['date_costs']['date'][4:6] }}</span>
            <div class="data">{{ weekInfo[6]['date_costs']['cost'] }}</div>
          </div>
        </div>
        <div class="column is-narrow">
          <div class="box">
            <span class="day">월</span>
            <span class="date">{{ weekInfo[0]['date_costs']['date'][4:6] }}</span>
            <div class="data">{{ weekInfo[0]['date_costs']['cost'] }}</div>
          </div>
        </div>
        <div class="column is-narrow">
          <div class="box">
            <span class="day">화</span>
            <span class="date">{{ weekInfo[1]['date_costs']['date'][4:6] }}</span>
            <div class="data">{{ weekInfo[1]['date_costs']['cost'] }}</div>
          </div>
        </div>
        <div class="column is-narrow">
          <div class="box">
            <span class="day">수</span>
            <span class="date">{{ weekInfo[2]['date_costs']['date'][4:6] }}/span>
            <div class="data">{{ weekInfo[2]['date_costs']['cost'] }}</div>
          </div>
        </div>
        <div class="column is-narrow">
          <div class="box">
            <span class="day">목</span>
            <span class="date">{{ weekInfo[3]['date_costs']['date'][4:6] }}</span>
            <div class="data">{{ weekInfo[3]['date_costs']['cost'] }}</div>
          </div>
        </div>
        <div class="column is-narrow">
          <div class="box">
            <span class="day">금</span>
            <span class="date">{{ weekInfo[4]['date_costs']['date'][4:6] }}</span>
            <div class="data">{{ weekInfo[4]['date_costs']['cost'] }}</div>
          </div>
        </div>
        <div class="column is-narrow">
          <div class="box">
            <span class="day">토</span>
            <span class="date">{{ weekInfo[5]['date_costs']['date'][4:6] }}</span>
            <div class="data">{{ weekInfo[5]['date_costs']['cost'] }}</div>
          </div>
        </div>#}-->
      </div>

      <div class="content">
        {% set total_costs = weekInfo | map(attribute='total_cost') | sum %}
        <p>- 총 금액: {{ total_costs }}원</p>
        <p>- 오늘의 나의 순위: {{ today_rank }}위</p>
        <p>- 이번 주의 나의 순위: {{ weekly_rank }}위</p>
      </div>
    </div>
  </section>
</body>
</html>
