<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>일일소비| 정글 거지방</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.3/css/bulma.min.css">


  <!-- JS -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
  integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
  crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
  integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
  crossorigin="anonymous"></script>

<!-- ajax -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <style>
    .box {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
      padding: 1rem;
    }
    .button.is-light:hover {
      background-color: #b5b5b5;
    }
    .button.is-danger {
      background-color: #f14668;
    }
    .button.is-success {
      background-color: #48c774;
    }
    .button.is-info {
      background-color: #209cee;
      color: white;
    }
    .control {
      padding:0 4px;
    }
    .is-size-2 {
      padding: 20px 0;
    }
</style>
<script>
        function deleteData(elem) {

            // elem이 속한 카드를 찾아서 edit-box와 shown-box를 토글하기
            let memo = $(elem).closest(".shown-box");
            let editBox = memo.find(".edit-box");
            let shownBox = card.find(".shown-box");

            // id 값 edit-box의 display 값이 block 이면(= 눈에 안보이면)
            if ($(editBox).css("display") == "none") {
                // edit-box를 가리고
                $(shownBox).css('display', 'none');
                $(editBox).css('display', 'block');
            } else {
                // 아니면(눈에 보이면) edit-box를 펴라
                $(shownBox).css('display', 'block');
                $(editBox).css('display', 'none');
            }
        }

        function postMemos() {

            let category = $("#post-title").val();
            let cost = $("#post-comment").val();

            if (title.trim() === "" || comment.trim() === "") {
                alert("빈 칸을 모두 입력하세요!")
                return;

            } else {
                $.ajax({
                    type: "POST",
                    url: "/memo",
                    data: {
                        Category_give: category,
                        Cost_give: cost
                    },
                    success: function (response) {
                        if (response["result"] == "success") {
                            alert("포스팅 성공!");
                            // 성공하면 페이지 새로고침하기
                            window.location.reload();
                        } else {
                            alert("서버오류! 포스팅 실패")
                        }
                    }
                })
            }


        }
        
        function showMemos() {
            $.ajax({
                type: "GET",
                url: "/memo",
                data: {},
                success: function (response) {
                    let memos = response["memos"];
                    for (let i = 0; i < memos.length; i++) {
                        makeCard(memos[i]["title"], memos[i]["comment"], memos[i]["likes"], memos[i]["_id"], memos[i]["display"]);
                    }
                }
            })
        }


        function makeCard(thing, cost) {
            let tempHtml = `
            {% for member in costMember %}
              <div class="box shown-box">
        
              <div>
                <span>{{ member.category }}</span>
                <span>:</span>
                <span>{{ member.cost }}원</span>
              </div>
   
              <div>
                <button class="button is-danger" onclick="deleteData(this)">삭제</button>
                <button class="button is-success" onclick="editData(this)">수정</button>
              </div>
              </div>
      {% endfor %}

      <!-- 눈에 안보이는 박스 -->
            <div class="box edit-box" style="display:none">
              <div class="field has-addons">
                <p class="control">
                  <input id="post-title" class="input" type="text" value="">
                </p>
                <p> : </p>
                <p class="control">
                  <input id="post-cost" class="input" type="text" value="">
                </p>
                <p class="control">
                  <span>원</span>
                </p>
              </div>
              
              <div>
                <button class="button is-warning" onclick="editMemos(this)">저장</button>
              </div>
            </div>`;
            $("#add-box").before(tempHtml);

        }
    </script>

</head>

<body>

</head>
<body>
  <section class="section">
    <div class="container">
      <div class="field">
        <div class="control">
          <button onClick="location.href='/myPage'" class="button is-light">돌아가기</button>
        </div>
      </div>

      <div>
        <h1 class="is-size-2">{{month}}월 {{day}}일</h1>
      </div>

      <!-- 붙을내용 -->

       <!-- 눈에 보이는 박스   -->
       {% for member in costMember %}
      <div class="box shown-box">
        <div>
            <span>{{ member.category }}</span>
            <span>:</span>
            <span>{{ member.cost }}원</span>
        </div>
   
          <div>
            <button id="deleteBtn" class="button is-danger" onclick="deleteData(this)">삭제</button>
            <button id="editBtn" class="button is-success" onclick="editData(this)">수정</button>
          </div>
      </div>
      {% endfor %}

      <!-- 눈에 안보이는 박스 -->
      <div class="box edit-box" style="display:none">
        <div class="field has-addons">
          <p class="control">
            <input id="post-title" class="input" type="text" value="">
          </p>
          <p> : </p>
          <p class="control">
            <input id="post-cost" class="input" type="text" value="">
          </p>
          <p class="control">
            <span>원</span>
          </p>
        </div>
        
        <div>
          <button id="saveBtn" class="button is-warning" onclick="saveData(this)">저장</button>
        </div>
      </div>

      <div id="add-box" class="box">
        <div class="field has-addons">
          <p class="control">
            <input id="post-title" class="input" type="text" placeholder="항목">
          </p>
          <p> : </p>
          <p class="control">
            <input id="post-cost" class="input" type="text" placeholder="금액">
          </p>
          <p class="control">
            <span>원</span>
          </p>
        </div>
        <button id="addBtn" class="button is-info" onclick="addData()">추가</button>
      </div>
    </div>
  </section>
</body>
</html>
